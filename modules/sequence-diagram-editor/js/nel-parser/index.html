<!DOCTYPE html>
<html>
<head>
    <title>ANTLR on the Web</title>
    <script type="text/javascript" src="lib/required_js/require.js"></script>
    <script>
        function receiveMessage(event)
       {
           document.getElementById("test").innerHTML = "received: "+event.data;
           //eventOrigin = event.origin || event.originalEvent.origin;
           var source = event.data;
           generateTreeObject(source);
           event.source.postMessage(
                   generatedTree,
                   "http://localhost:63342/wso2-tooling"
           );
        }
        window.addEventListener("message", receiveMessage, false);
    </script>
    <!--<script type="text/javascript">-->
        <!--function sendMessage() {-->
            <!--var win = document.getElementById("iframe").contentWindow;-->

            <!--win.postMessage(-->
                    <!--generatedTree,-->
                    <!--"http://localhost:63342/wso2-tooling"-->
            <!--);-->
        <!--}-->

    <!--</script>-->
</head>
<body>
<div id="test">Send me a message!</div>

<div id="inputs">
    <button id="parse">Parse</button>

</div>
<script type="text/javascript">
    var  generatedTree;
    var antlr4 = require('antlr4/index');
    var NELLexer = require('generated-parser/NELLexer');
    var NELParser = require('generated-parser/NELParser');
    var NELListener = require('js/NELListenerImpl');

    function generateTreeObject(source) {
        var antlr4 = require('antlr4/index');
        var NELLexer = require('generated-parser/NELLexer');
        var NELParser = require('generated-parser/NELParser');
        var NELListener = require('js/NELListenerImpl');

        var chars = new antlr4.InputStream(source);
        var lexer = new NELLexer.NELLexer(chars);
        var tokens = new antlr4.CommonTokenStream(lexer);
        var parser = new NELParser.NELParser(tokens);
        var listener = new NELListenerImpl();
        parser.buildParseTrees = true;
        var tree = parser.sourceFile();
        var x = antlr4.tree.ParseTreeWalker.DEFAULT.walk(listener, tree);
    }
</script>
<div id="tree">
</div>
</body>
</html>